<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Read Book</title>

  <!-- Favicon & Manifest -->
  <link rel="icon" type="image/png" href="public/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="public/favicon.svg" />
  <link rel="shortcut icon" href="public/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="public/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Book Tracker" />
  <link rel="manifest" href="public/site.webmanifest" />

  <!-- Styles -->
  <link rel="stylesheet" href="styles/index.css">
  <link rel="stylesheet" href="styles/book.css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

  <!-- Back to Top Button -->
  <button id="backToTop" title="Back to top" type="button">â†‘</button>

  <!-- Header -->
  <header class="nav">
    <a href="index.html" class="back-btn">â† Back to Library</a>
    <span class="nav-brand">ğŸ“– Read Book</span>
  </header>

  <section class="jumbotron">
    <img src="images/authorImage.jpg" alt="Author" />
    <div>
      <h1>Author: Sarah Winter Shaw</h1>
      <h3>Self-Published</h3>
      <p>Read your completed books here.</p>
    </div>
  </section>

  <main class="reading-container">
    <h1 class="book-title">Read Your Book</h1>

    <!-- Book Selection Dropdown -->
    <div>
      <label for="bookDropdown">Select a Completed Book:</label>
      <select id="bookDropdown" class="form-select" onchange="loadBook(this.value)">
        <option value="">-- No Completed Books --</option>
      </select>
    </div>

    <!-- Embedded Google Doc Viewer -->
    <iframe id="bookViewer" src="" width="100%" height="600" style="border-radius:16px;border:2px solid #2f4f3e;"></iframe>
  </main>

  <footer class="site-footer">
    <p>&copy; 2026 Sarah. All rights reserved.</p>
    <p>
      <a href="privacyPolicy.html">ğŸ”’ Privacy Policy</a> |
      <a href="legalDisclaimer.html">ğŸ“„ Legal Disclaimer</a>
    </p>
  </footer>

<script>
const viewer = document.getElementById("bookViewer");
const dropdown = document.getElementById("bookDropdown");

const cards = JSON.parse(localStorage.getItem("bookCards") || "[]");
const completed = cards
  .map((c,i)=>({ ...c, index:i }))
  .filter(c => c.stages[4] && c.googleDoc);

// Populate dropdown
dropdown.innerHTML = completed.length
  ? `<option value="">-- Select a Book --</option>`
  : `<option value="">-- No Completed Books --</option>`;

completed.forEach(b => {
  const opt = document.createElement("option");
  opt.value = b.index;
  opt.textContent = b.title || `Book ${b.index+1}`;
  dropdown.appendChild(opt);
});

// Convert Google Doc â†’ embed with minimal UI and better fit
function embedDoc(url) {
  return url.replace("/edit", "/preview") + "&rm=minimal&chrome=false&embedded=true";
}

// Load book into viewer
function loadBook(index) {
  if (!index) return;
  const book = cards[index];
  viewer.src = embedDoc(book.googleDoc);
  localStorage.setItem("activeBookIndex", index);
}

// Auto-load last selected book
const active = localStorage.getItem("activeBookIndex");
if (active) {
  dropdown.value = active;
  loadBook(active);
}

// Back to Top Button
const backToTop = document.getElementById("backToTop");
window.onscroll = () => {
  if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
    backToTop.style.display = "block";
  } else {
    backToTop.style.display = "none";
  }
};
backToTop.addEventListener("click", () => window.scrollTo({ top:0, behavior:'smooth' }));
</script>

</body>
</html>
