<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Read Book</title>

  <!-- Favicon & Manifest -->
  <link rel="icon" type="image/png" href="public/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="public/favicon.svg" />
  <link rel="shortcut icon" href="public/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="public/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Book Tracker" />
  <link rel="manifest" href="public/site.webmanifest" />

  <!-- Custom Styles -->
   <link rel="stylesheet" href="styles/index.css">
  <link rel="stylesheet" href="styles/book.css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

  <!-- Back to Top Button -->
  <button id="backToTop" title="Back to top" type="button">‚Üë</button>

  <!-- Header -->
  <header class="nav">
    <a href="index.html" class="back-btn">‚Üê Back to Library</a>
    <span class="nav-brand">üìñ Read Book</span>
  </header>

  <section class="jumbotron">
  <img src="images/authorImage.jpg" alt="Author" />
  <div>
    <h1>Author: Sarah Winter Shaw</h1>
    <h3>Self-Published</h3>
    <p>Read your completed books here.</p>
  </div>
</section>

  <!-- Main Content -->
  <main class="reading-container">
    <h1 class="book-title">Read Your Book</h1>

    <!-- Book Selection Dropdown -->
    <div>
      <label for="bookDropdown">Select a Completed Book:</label>
      <select id="bookDropdown" class="form-select" onchange="loadBook(this.value)">
        <option value="">-- No Completed Books --</option>
      </select>
    </div>

    <!-- Embedded PDF / Google Doc Viewer -->
    <object id="bookViewer" data="" type="application/pdf">
      <p>Your browser does not support PDFs. 
      <a id="downloadLink" href="" target="_blank">Download the PDF</a>.</p>
    </object>
  </main>

  <!-- Footer -->
 <footer class="site-footer">
  <p>&copy; 2026 Sarah. All rights reserved.</p>
  <p>
    <a href="privacyPolicy.html">üîí Privacy Policy</a> |
    <a href="legalDisclaimer.html">üìÑ Legal Disclaimer</a>
  </p>
</footer>

  <!-- Scripts -->
  <script>
    const bookViewer = document.getElementById("bookViewer");
    const bookDropdown = document.getElementById("bookDropdown");
    const downloadLink = document.getElementById("downloadLink");

    // Load completed books from localStorage
    const cards = JSON.parse(localStorage.getItem("bookCards") || "[]");
    const completedBooks = cards
      .map((c, i) => ({ ...c, index: i }))
      .filter(c => c.stages[4]); // Completed stage

    // Populate dropdown
    if (completedBooks.length > 0) {
      bookDropdown.innerHTML = `<option value="">-- Select a Book --</option>`;
      completedBooks.forEach(book => {
        const option = document.createElement("option");
        option.value = book.index; // use index to retrieve later
        option.textContent = book.title || `Book ${book.index + 1}`;
        bookDropdown.appendChild(option);
      });
    } else {
      bookDropdown.innerHTML = `<option value="">-- No Completed Books --</option>`;
    }

    // Load book into viewer
    function loadBook(index) {
      if (index === "") return;
      const book = cards[index];

      // Check if book has a link or PDF (for now assume PDF in publishDate placeholder)
      const filePath = book.link || book.publishDateFile || ""; // placeholder, you can add a proper file path property
      if (!filePath) {
        bookViewer.innerHTML = `<p>No PDF or document uploaded for this book.</p>`;
        downloadLink.href = "#";
        return;
      }

      bookViewer.data = filePath;
      downloadLink.href = filePath;
    }

    // Auto-select active book if set
    const activeBookIndex = localStorage.getItem("activeBookIndex");
    if (activeBookIndex !== null) {
      bookDropdown.value = activeBookIndex;
      loadBook(activeBookIndex);
    }

    // Back to Top Button Logic
    const backToTop = document.getElementById("backToTop");
    window.onscroll = function() {
      if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
        backToTop.style.display = "block";
      } else {
        backToTop.style.display = "none";
      }
    };
    backToTop.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    // Set current year
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>

</body>
</html>
