<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Read Book</title>

  <link rel="icon" type="image/png" href="public/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="public/favicon.svg" />
  <link rel="shortcut icon" href="public/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="public/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Book Tracker" />
  <link rel="manifest" href="public/site.webmanifest" />

  <link rel="stylesheet" href="styles/index.css">
  <link rel="stylesheet" href="styles/book.css">
  <link rel="stylesheet" href="styles/book-viewer.css">

  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

  <button id="backToTop" title="Back to top">‚Üë</button>

  <header class="nav">
    <a href="index.html" class="back-btn">‚Üê Back to Library</a>
    <span class="nav-brand">üìñ Read Book</span>
  </header>

  <section class="jumbotron">
    <img src="images/authorImage.jpg" alt="Author" />
    <div>
      <h1>Author: Sarah Winter Shaw</h1>
      <h3>Self-Published</h3>
      <p>Read your completed books here.</p>
    </div>
  </section>

  <main class="reading-container">
    <h1 class="book-title">Read Your Book</h1>

    <div>
      <label for="bookDropdown">Select a Completed Book:</label>
      <select id="bookDropdown" class="form-select" onchange="loadBook(this.value)">
        <option value="">-- No Completed Books --</option>
      </select>
    </div>

    <div id="viewerWrapper">
      <iframe id="bookViewer" class="book-viewer" title="Book viewer" src="" width="100%" height="80vh" aria-label="Book content"></iframe>
    </div>
  </main>

  <footer class="site-footer">
    <p>&copy; 2026 Sarah. All rights reserved.</p>
    <p>
      <a href="privacyPolicy.html">üîí Privacy Policy</a> |
      <a href="legalDisclaimer.html">üìÑ Legal Disclaimer</a>
    </p>
  </footer>

  <script>
    const viewerWrapper = document.getElementById("viewerWrapper");
    const dropdown = document.getElementById("bookDropdown");
    const cards = JSON.parse(localStorage.getItem("bookCards") || "[]");

    // Only completed books with a Google Doc link
    const completedBooks = cards
      .map((c,i)=>({ ...c, index:i }))
      .filter(c => c.stages[4] && c.googleDoc);

    // Populate dropdown
    dropdown.innerHTML = completedBooks.length
      ? `<option value="">-- Select a Book --</option>`
      : `<option value="">-- No Completed Books --</option>`;

    completedBooks.forEach(b => {
      const opt = document.createElement("option");
      opt.value = b.index;
      opt.textContent = b.title || `Book ${b.index+1}`;
      dropdown.appendChild(opt);
    });

    // Use published Google Doc embed link
    function embedDoc(url) {
      if (!url.includes("/pub?embedded=true")) {
        alert("Please use a published Google Doc link (File ‚Üí Publish to web ‚Üí Embed).");
      }
      return url;
    }

    function loadBook(index) {
      if (!index) return;
      const book = cards[index];
      viewerWrapper.innerHTML = `
        <iframe id="bookViewer" class="book-viewer" title="Book viewer"
          src="${embedDoc(book.googleDoc)}"
          width="100%" height="80vh" aria-label="Book content">
        </iframe>`;
      localStorage.setItem("activeBookIndex", index);
    }

    // Auto-load last book
    const active = localStorage.getItem("activeBookIndex");
    if (active) {
      dropdown.value = active;
      loadBook(active);
    }

    // Back to Top button
    const backToTop = document.getElementById("backToTop");
    window.onscroll = () => {
      backToTop.style.display = (document.documentElement.scrollTop > 200) ? "block" : "none";
    };
    backToTop.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  </script>

</body>
</html>
