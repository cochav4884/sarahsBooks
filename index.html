<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sarah's Book Tracker</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles/index.css" />
</head>
<body>

<header class="nav">
  <a href="index.html" class="logo-link">
    <img src="images/logo.jpg" alt="Logo" class="nav-logo" />
    <span class="nav-brand">ğŸ“š Book Tracker</span>
  </a>
</header>

<section class="jumbotron">
  <img src="images/authorImage.jpg" alt="Author" />
  <div>
    <h1>Author: Sarah Winter Shaw</h1>
    <h3>Self-Published</h3>
    <p>Track every book from planning to publication.</p>
  </div>
</section>

<main>
  <section id="cardsContainer"></section>

  <div class="controls">
    <button type="button" id="addCard">â• Add Book</button>
    <button type="button" id="resetAll">ğŸ”„ Reset All</button>
  </div>
</main>

<footer class="site-footer">
  <p>&copy; 2026 Sarah. All rights reserved.</p>
  <p>
    <a href="privacyPolicy.html">ğŸ”’ Privacy Policy</a> |
    <a href="legalDisclaimer.html">ğŸ“„ Legal Disclaimer</a>
  </p>
</footer>

<script>
const STORAGE_KEY = "bookCards";
const STAGES = ["Planning", "Rough Draft", "Second Draft", "Final Draft", "Completed"];

// ---------- HELPERS ----------
function convertToEmbed(url) {
  if (!url) return "";
  if (url.includes("/pub?embedded=true")) return url;
  return url.replace(/\/edit.*$/, "/pub?embedded=true");
}

// ---------- CREATE EMPTY CARD ----------
function createEmptyCard() {
  return {
    title: "",
    stages: Array(5).fill(false),
    googleDoc: "",
    startDate: "",
    completedDate: "",
    publishDate: "",
    copyrightDate: ""
  };
}

// ---------- STORAGE ----------
function loadCards() {
  return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
}

function saveCards(cards) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(cards));
}

// ---------- RENDER ----------
function renderCards() {
  const container = document.getElementById("cardsContainer");
  container.innerHTML = "";

  let cards = loadCards();
  if (cards.length === 0) {
    cards.push(createEmptyCard());
    saveCards(cards);
  }

  cards.forEach((card, index) => {
    const cardEl = document.createElement("div");
    cardEl.className = "book-card collapsed";

    cardEl.innerHTML = `
      <div class="title-container">
        <input class="title" placeholder="Book Title" value="${card.title}">
        <button class="btn delete">ğŸ—‘ï¸ Delete</button>
      </div>

      <div class="card-content">
        <div class="stages">
          ${STAGES.map((s,i)=>`
            <label>
              <input type="checkbox" ${card.stages[i] ? "checked" : ""} data-stage="${i}">
              ${s}
            </label>
          `).join("")}
        </div>

        <div class="completed-link" style="display:${card.stages[4] ? "block" : "none"}">
          <label>
            Google Docs Link (Completed Book)
            <input type="url" placeholder="Paste Google Docs link"
              value="${card.googleDoc}">
          </label>
        </div>

        <div class="dates">
          <label>Start <input type="date" value="${card.startDate}"></label>
          <label>Completed <input type="date" value="${card.completedDate}"></label>
          <label>Published <input type="date" value="${card.publishDate}"></label>
          <label>Copyright <input type="date" value="${card.copyrightDate}"></label>
        </div>

        <div class="card-actions">
          <button class="btn read-book" ${card.stages[4] && card.googleDoc ? "" : "style='display:none'"}>ğŸ“– Read Book</button>
          <button class="btn reset">ğŸ”„ Reset</button>
        </div>
      </div>
    `;

    // ---------- ACCORDION ----------
    cardEl.querySelector(".title-container").onclick = e => {
      if (e.target.classList.contains("delete")) return;
      document.querySelectorAll(".book-card").forEach(c => c.classList.add("collapsed"));
      cardEl.classList.toggle("collapsed");
    };

    const titleInput = cardEl.querySelector(".title");
    const docInput = cardEl.querySelector(".completed-link input");
    const stageBoxes = cardEl.querySelectorAll(".stages input");
    const readBtn = cardEl.querySelector(".read-book");

    function updateCard() {
      card.title = titleInput.value;
      card.googleDoc = convertToEmbed(docInput.value.trim());
      stageBoxes.forEach(cb => card.stages[cb.dataset.stage] = cb.checked);

      readBtn.style.display = (card.stages[4] && card.googleDoc) ? "inline-block" : "none";

      const cards = loadCards();
      cards[index] = card;
      saveCards(cards);
    }

    titleInput.oninput = updateCard;
    docInput.oninput = updateCard;
    stageBoxes.forEach(cb => cb.onchange = updateCard);

    // ---------- READ ----------
    readBtn.onclick = () => {
      localStorage.setItem("activeBookIndex", index);
      window.location.href = "book.html";
    };

    // ---------- DELETE ----------
    cardEl.querySelector(".delete").onclick = () => {
      if(confirm("Delete this book?")) {
        const cards = loadCards();
        cards.splice(index,1);
        saveCards(cards);
        renderCards();
      }
    };

    // ---------- RESET ----------
    cardEl.querySelector(".reset").onclick = () => {
      const cards = loadCards();
      cards[index] = createEmptyCard();
      saveCards(cards);
      renderCards();
    };

    container.appendChild(cardEl);
  });
}

// ---------- BUTTONS ----------
document.getElementById("addCard").onclick = () => {
  const cards = loadCards();
  cards.push(createEmptyCard());
  saveCards(cards);
  renderCards();
};

document.getElementById("resetAll").onclick = () => {
  if(confirm("Reset all books?")) {
    localStorage.removeItem(STORAGE_KEY);
    renderCards();
  }
};

// ---------- INIT ----------
renderCards();
</script>

</body>
</html>
